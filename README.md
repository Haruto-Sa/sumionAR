# ARjsサンプル

## 岩手県のARプロジェクトのデモ版のコード

AR.jsを使用したWebベースの拡張現実（AR）デモプロジェクトです。マーカーベースARと位置情報ベースARの両方をサポートしています。

## 特徴

- 🎯 **マーカーベースAR**: Hiroマーカーを使用した3Dコンテンツの表示
- 📦 **モデルショーケースAR**: 全6モデルを一度に円形配置で表示（マーカーベース）
- 🎨 **全モデルギャラリーAR**: 全8モデル（assets + models）を個別切り替えで閲覧（マーカーベース）
- 🖼️ **3Dモデルビューアー**: ARマーカー不要・マウス/タッチでインタラクティブに操作可能
- 📍 **位置情報ベースAR**: GPS座標に基づくAR体験（岩手県の名所に対応）
- 📡 **近距離AR**: 現在地から50m四方に自動配置（位置情報ベース）
- 📱 **モバイル対応**: スマートフォンやタブレットで動作
- 🌐 **ブラウザベース**: アプリのインストール不要
- 🔄 **モード切替**: 複数のARモードを簡単に切り替え可能

## プロジェクト構成

```
ARjs/
├── index.html                  # トップページ（モード選択）
├── marker-ar.html              # マーカーベースARページ
├── location-ar.html            # 位置情報ベースARページ（固定地点）
├── nearby-ar.html              # 近距離AR（50m四方・自動配置）
├── models-showcase-ar.html     # モデルショーケースAR（全モデル同時表示）
├── all-models-gallery-ar.html  # 全モデルギャラリーAR（個別切り替え）
├── 3d-models-viewer.html       # 3Dモデルビューアー（AR不要・インタラクティブ）
├── test-viewer.html            # GLBテストページ（AR無し・デバッグ用）
├── map.html                    # AR地点マップページ
├── server.py                   # ログ機能付きHTTPサーバー（MIME/CORS/デコーダ対応）
├── styles.css                  # スタイルシート
├── src/                        # Vite + TypeScript のソースコード（位置情報ARなど）
├── dist/                       # Viteビルド出力（自動生成）
├── gitupload/                  # 公開用に dist をまとめたフォルダ（GitHub Pages 等）
├── assets/
│   ├── markers/                # マーカー画像用ディレクトリ
│   ├── models/                 # 3Dモデル用ディレクトリ（Duck.glb、suimon-kousin.glb）
│   └── README.md               # アセットの使い方
├── models/                     # 追加3Dモデル群
│   ├── glb/                    # GLBフォーマット（6モデル）
│   ├── gltf/                   # GLTFフォーマット（6モデル）
│   └── manifest.json           # モデル一覧
├── doc/                        # ドキュメント
│   ├── SERVER_LOG_README.md    # サーバーログ機能の説明
│   ├── TROUBLESHOOTING.md      # トラブルシューティング
│   └── setup-ioscheck.md       # スマホ・iOS動作確認手順
└── README.md                   # このファイル
```

※ `src/` 配下に位置情報ARなどのロジックを TypeScript で実装し、Vite でビルドすると `dist/` に出力されます。  
※ 本番公開用には、`dist/` の内容を `gitupload/` にまとめて GitHub Pages などにアップロードする想定です。

## 使い方

### 1. Viteベースの開発フロー（推奨）

カメラアクセスにはHTTPSまたはlocalhostが必要です。  
ここでは **Vite + TypeScript（`src/` ディレクトリ）を前提とした実行方法** を中心に説明します。

#### 1-1. 前提環境

- **Node.js**: 推奨 v18 以降（LTS 系）  
- **npm**: Node.js に同梱されているものでOK  
- 端末から `node -v` / `npm -v` でバージョンを確認してください。

#### 1-2. 初回セットアップ

依存パッケージをインストールします（初回のみ）。

```bash
cd /Users/harutosasaki/GithubRepo/ARjs
npm install
```

`package.json` の `scripts` は次のようになっています:

```json
{
  "scripts": {
    "dev": "vite",
    "build": "vite build",
    "preview": "vite preview"
  }
}
```

#### 1-3. 開発サーバーの起動（ホットリロード付き）

Vite開発サーバーを起動すると、`src/` 配下の TypeScript を編集した内容がすぐにブラウザへ反映されます。

```bash
cd /Users/harutosasaki/GithubRepo/ARjs
npm run dev        # Vite開発サーバー起動（vite.config.mjs で port=8000）
```

起動後、ブラウザで次のようにアクセスできます。

- **トップページ**: `http://localhost:8000/` （`index.html`）
- **位置情報AR**: `http://localhost:8000/location-ar.html`
- **近距離AR**: `http://localhost:8000/nearby-ar.html`
- **その他**: `location-ar2.html`, `location-ar-targets2.html`, `location-ar-manual.html` なども同様

**ポイント**:
- `src/location-ar/main.ts` など、`src/` 以下のロジックを変更すると自動で再ビルドされ、ブラウザがリロードされます。
- HTML側からは、Viteが生成するバンドル（`dist/assets/*.js`）が読み込まれますが、開発時はそれを意識せず **TypeScriptだけ編集** すればOKです。

#### 1-4. 本番ビルド（`dist/` の生成）

本番用に最適化されたファイルを出力するには、次のコマンドを実行します。

```bash
cd /Users/harutosasaki/GithubRepo/ARjs
npm run build      # dist/ にビルド成果物を出力
```

- `dist/index.html`
- `dist/location-ar.html`
- `dist/assets/*.js` / `dist/assets/*.css`

などが生成されます。  
生成された `dist/` は、そのまま静的ホスティングサービスにアップロードしても動作します。

#### 1-5. 本番ビルドのローカル確認（Vite Preview）

Viteが提供するプレビューサーバーで、本番ビルドの挙動をローカル確認できます。

```bash
cd /Users/harutosasaki/GithubRepo/ARjs
npm run preview    # デフォルトでは http://localhost:4173 で起動
```

ブラウザで `http://localhost:4173` を開き、`index.html` や `location-ar.html` などを実際の本番ビルドと同じ構成で確認できます。

#### 1-6. `gitupload/` への反映（公開用フォルダ）

GitHub Pages などで公開する場合は、ビルドした `dist/` の内容を `gitupload/` にまとめて配置します。

- `npm run build` 実行後、`dist/` の中身を `gitupload/` にコピーする運用を想定しています。
- `gitupload/` 以下には、公開に必要なHTML・JS・モデルファイルなどを一式まとめてあります。

具体的な公開手順や前提は、`gitupload/README.md` も参照してください。

---

### 2. 補足: Python製ログ付きサーバー（server.py）

Vite を使わず、Python のサーバーで **モデル読み込み・表示状況をログに記録**したい場合に利用できます。

```bash
cd /Users/harutosasaki/GithubRepo/ARjs
python3 server.py
```

サーバーが起動すると：
- ブラウザで `http://localhost:8000` を開く
- ARの動作状況が `ar_model_logs.txt` に自動記録される
- コンソールにリアルタイムでログが表示される

詳細は [doc/SERVER_LOG_README.md](doc/SERVER_LOG_README.md) を参照。

### 3. 補足: シンプルなHTTPサーバーのみ使う場合

ログ機能や Vite を使わず、**ビルド済みの静的ファイルだけ** を配信したい場合に利用します。  
（例: `dist/` または `gitupload/` をルートとして配信）

**Python 3の場合:**

```bash
python3 -m http.server 8000
```

**Node.jsの場合:**

```bash
npx http-server -p 8000
```

ブラウザで `http://localhost:8000` を開きます。

---

### 4. マーカーベースARの使用

### 4. マーカーベースARの使用

1. トップページで「Launch Marker AR」をクリック
2. カメラへのアクセスを許可
3. [Hiroマーカー](https://raw.githubusercontent.com/AR-js-org/AR.js/master/data/images/hiro.png)を印刷するか、別の画面に表示
4. カメラでマーカーをスキャン
5. マーカー上に3Dオブジェクトが表示されます

### 5. モデルショーケースARの使用

1. Hiroマーカーを準備（印刷または別画面で表示）
2. トップページで「モデルショーケースARを起動」をクリック
3. カメラへのアクセスを許可
4. マーカーをカメラに向ける

#### 表示されるモデル（全6モデル同時表示）:

| モデル名 | 配置 | 色 | 説明 |
|---------|------|-----|------|
| **Color Cube** | 中央 | 🔴 赤 | カラフルなユニットキューブ |
| **Tall Pyramid** | 前方（0度） | 🟡 黄 | 四角錐 |
| **Triangular Prism** | 右前方（72度） | 🔵 水色 | 三角柱 |
| **Octa Diamond** | 右後方（144度） | 🟢 緑 | 八面体ダイヤモンド |
| **Hex Column** | 左後方（216度） | 💚 淡緑 | 六角柱（ピラーやクリスタル用） |
| **Low Poly Rock** | 左前方（288度） | 💗 ピンク | ローポリの岩 |

**配置パターン（マーカー上空から見た図）**:
```
        Tall Pyramid
             ↑
             
Low Poly ←  Color  → Triangular
  Rock      Cube       Prism
             ↓
      Hex   ↓   Octa
     Column     Diamond
```

**特徴**:
- **全6モデル同時表示**: `models/glb/`ディレクトリの全GLBモデルを一度に表示
- **円形配置**: 中央に1つ、周囲に半径2.5の円周上に5つを72度間隔で配置
- **個別回転**: 各モデルが異なる速度で回転（8秒〜13秒）
- **ラベル表示**: 各モデルの上に英語名を表示
- **読み込み状態監視**: コンソールで全モデルの読み込み完了を検出

**確認のポイント**: 
- マーカーを検出すると、中央と周囲に計6つのモデルが表示されます
- 各モデルは独立して回転します
- 情報オーバーレイで読み込み状態を確認できます
- コンソールで各モデルの詳細ログを確認可能

### 4. 全モデルギャラリーARの使用

1. Hiroマーカーを準備（印刷または別画面で表示）
2. トップページで「全モデルギャラリーARを起動」をクリック
3. カメラへのアクセスを許可
4. マーカーをカメラに向ける
5. **左側のモデル選択パネル**から好きなモデルをクリックして切り替え

#### 閲覧可能なモデル（全8モデル）:

| # | モデル名 | ディレクトリ | ファイル名 | アイコン |
|---|---------|------------|-----------|---------|
| 1 | **Duck** | assets/models | Duck.glb | 🦆 |
| 2 | **Suimon Kousin** | assets/models | suimon-kousin.glb | 🏛️ |
| 3 | **Color Cube** | models/glb | color_cube.glb | 🟥 |
| 4 | **Tall Pyramid** | models/glb | tall_pyramid.glb | 🔺 |
| 5 | **Triangular Prism** | models/glb | triangular_prism.glb | 🔷 |
| 6 | **Octa Diamond** | models/glb | octa_diamond.glb | 💎 |
| 7 | **Hex Column** | models/glb | hex_column.glb | ⬢ |
| 8 | **Low Poly Rock** | models/glb | lowpoly_rock.glb | 🪨 |

**UI構成**:
```
┌──────────────────────────────────┐
│ ← ホーム    📦 表示中: Duck     │
├──────────────┬───────────────────┤
│              │                   │
│ 📦 モデル選択 │   [ARカメラ]      │
│              │                   │
│ 🎨 Assets(2) │   [マーカー上に   │
│  🦆 Duck     │    選択モデル]    │
│  🏛️ Suimon  │                   │
│              │                   │
│ 🔷 Models(6) │                   │
│  🟥 Cube     │                   │
│  🔺 Pyramid  │    📊 統計        │
│  ...         │    読込: 8/8      │
│              │    マーカー: 検出中 │
└──────────────┴───────────────────┘
```

**特徴**:
- **インタラクティブギャラリー**: 8つのモデルを個別に切り替えて表示
- **リアルタイム切り替え**: クリック1回でモデルを即座に変更
- **モデル分類表示**: Assets Models（2個）とModels Collection（6個）でグループ化
- **読み込み状態監視**: 右下の統計パネルで全モデルの読み込み状況を確認
- **キーボード操作対応**: 
  - `←` / `→` または `n` / `p`: 前/次のモデルへ切り替え
  - `1` ～ `8`: 対応するモデルへ直接ジャンプ
- **自動回転**: 選択したモデルが自動的に回転表示

**使い方のポイント**:
- モデル選択パネルは**スクロール可能**です
- 選択中のモデルは**ピンク色**でハイライト表示されます
- 上部の青いバーに現在表示中のモデル名が表示されます
- マーカーを離すと表示が一時停止し、再度検出すると再開します
- すべてのモデルが事前読み込みされるため、切り替えが高速です

**確認のポイント**: 
- マーカーを検出すると、選択したモデルが台座の上に表示されます
- 統計パネルで「読込: 8/8」が表示されたら全モデル準備完了
- 各モデルは個別のスケールと配置で最適化されています

### 7. 3Dモデルビューアーの使用（ARマーカー不要）

1. トップページで「3Dビューアーを起動」をクリック
2. **カメラ許可不要** - すぐに起動します
3. 左側のパネルからモデルを選択
4. マウスやタッチでモデルを自由に操作

#### インタラクティブ操作:

| 操作 | マウス | タッチ |
|------|--------|--------|
| **回転** | 左ドラッグ | スワイプ |
| **ズーム** | スクロール | ピンチ |
| **移動** | 右ドラッグ | 2本指ドラッグ |
| **リセット** | ダブルクリック | ダブルタップ |

#### キーボードショートカット:

| キー | 機能 |
|------|------|
| `←` / `p` | 前のモデルへ |
| `→` / `n` | 次のモデルへ |
| `1` ～ `8` | 対応モデルへ直接ジャンプ |

#### 表示される機能:

**UI構成**:
```
┌─────────────────────────────────────┐
│ 🎨 3Dモデルビューアー  🦆 Duck ←ホーム│
├────────────┬────────────────────────┤
│            │                        │
│ 📦 モデル選択│                        │
│ (全8種)    │     [3D表示領域]        │
│            │                        │
│ 🎨 Assets  │   ・マウスで回転        │
│  🦆 Duck★  │   ・スクロールでズーム  │
│  🏛️ Suimon│   ・右ドラッグで移動    │
│            │                        │
│ 🔷 Models  │                        │
│  🟥 Cube   │    🎮 操作方法          │
│  🔺 Pyramid│    ・回転: ドラッグ     │
│  ...       │    ・ズーム: スクロール │
│            │    ・移動: 右ドラッグ   │
└────────────┴────────────────────────┘
```

**特徴**:
- **ARマーカー不要**: カメラアクセスが不要で、PCでも快適に閲覧可能
- **フル3D操作**: Three.js OrbitControlsで自由な視点移動
- **高品質レンダリング**: シャドウ、ライティング、アンチエイリアス対応
- **自動カメラ調整**: モデルサイズに応じて最適な視点に自動配置
- **グリッド表示**: 地面のグリッドでスケール感を把握
- **ダンピング効果**: 滑らかなカメラ移動
- **レスポンシブデザイン**: PC・タブレット・スマートフォン対応

**使い方のポイント**:
- **初期状態は空** - ユーザーがモデルを選択するまで読み込みません
- モデル選択後、自動的に最適なカメラ位置に調整されます
- **ダブルクリック**でカメラ位置をリセットできます
- モバイルでは**ピンチ操作**で直感的にズーム可能
- **2本指ドラッグ**でモデルを画面内で移動できます
- 左側のパネルは×ボタンで閉じられます
- パネルを閉じると画面左上に📦ボタンが表示され、再度開けます

**読み込み表示**:
- **プログレスバー**: モデル名、パーセンテージ、ファイルサイズを表示
- **読み込み時間**: コンソールに表示（デバッグ用）
- **エラー詳細**: 失敗時に詳細な原因を表示

**確認のポイント**: 
- 初期画面に「👈 モデルを選択」と表示されます
- モデル選択後、ローディングスピナーとプログレスバーが表示されます
- プログレスバーで現在の読み込み状況を確認できます
- 読み込み完了後、モデルが中央に表示されます
- グリッドの1マスは1メートルに相当します
- シャドウが地面に投影され、立体感が向上します
- 複雑なモデルでも滑らかに操作できます

**技術仕様**:
- **レンダラー**: Three.js WebGLRenderer
- **カメラ**: PerspectiveCamera (FOV 50°)
- **コントロール**: OrbitControls (ダンピング有効)
- **ライティング**: Ambient Light + 2x Directional Light
- **シャドウ**: PCFSoftShadowMap
- **トーンマッピング**: ACESFilmicToneMapping
- **エンコーディング**: sRGBEncoding

### 8. 位置情報ベースARの使用

1. 屋外に移動（GPS信号が良好な場所）
2. トップページで「📍 地点マップを見る」をクリックして配置場所を確認（オプション）
3. 「位置情報ARを起動」をクリック
4. カメラと位置情報へのアクセスを許可
5. 画面右上の**地点選択ドロップダウン**で目標地点を選択
6. デバイスを360度ゆっくり回して周囲を見回す

#### 固定配置地点（5箇所）:

| 地点 | 座標 | オブジェクト | 特徴 |
|------|------|------------|------|
| **地点1** | 39.80219519, 141.13317981 | 🦆 アヒル | Duck.glb（スケール1000倍）・遠距離対応 |
| **地点2** | 39.80314254, 141.13606259 | 🔺 正四面体 | 赤・半径25m・3軸回転 |
| **地点3** | 39.80200737, 141.13553857 | 📦 ボックス | 水色・スケール100倍・45度傾斜 |
| **地点4** | 39.80279443, 141.13434547 | ⚙️ シリンダー | 緑・半径15m×高さ40m |
| **地点5** | 39.80245268, 141.13574406 | ⭐ 指定地点 | 正四面体+ボックス+黄色の輪（複合） |

#### 動的配置地点（現在地基準）:
- **北側（11m）**: 正四面体（赤・超大型）
- **南側（11m）**: ボックス（水色・超大型）
- **東側（13m）**: 球体（オレンジ・大型）
- **西側（13m）**: シリンダー（緑・大型）

#### 座標入力機能:
- 画面左上の「+ 座標入力」ボタンをクリック
- 緯度・経度・サイズ（m）を入力して「配置」ボタンをクリック
- 入力した座標に指定サイズのモデルが動的に配置されます

#### 距離・方向表示:
- 画面右上のパネルで選択した地点までの距離と方向をリアルタイム表示
- ドロップダウンで地点1〜5を切り替え可能
- 地点の詳細情報（座標・説明）も表示

**確認のポイント**: 
- 画面右上で目標地点を選択し、距離と方向を確認
- 地点1（アヒル）は最大50kmまで表示可能（遠距離対応）
- GPS精度により若干のズレがある場合があります
- 屋外で空が見える場所での使用を推奨
- デバッグ情報が画面に表示されます

### 9. 近距離AR（50m四方）の使用

1. 屋外に移動（GPS信号が良好な場所）
2. トップページで「近距離ARを起動」をクリック
3. カメラと位置情報へのアクセスを許可
4. **自動配置**: 現在地から東西南北50m地点に10mサイズのモデルが自動配置されます

#### 特徴:

- **自動配置**: GPS取得後、自動的に4方向に配置
- **固定表示**: 位置更新するまでモデルは同じ場所に表示され続ける
- **手動更新**: 画面右上の「🔄 位置更新」ボタンで再配置可能
- **配色**: 🔴北（赤）・🔵南（水色）・🟡東（黄色）・🟢西（緑）

#### 配置詳細:

| 方向 | 距離 | サイズ | 色 |
|------|------|--------|-----|
| 北 | 50m | 10m | 赤 (#FF6B6B) |
| 南 | 50m | 10m | 水色 (#4ECDC4) |
| 東 | 50m | 10m | 黄 (#FFE66D) |
| 西 | 50m | 10m | 緑 (#95E1D3) |

**使い方のポイント**:
- 起動後、3秒待ってもモデルが表示されない場合は「🔄 位置更新」をタップ
- 360度ゆっくり回転して各方向のモデルを確認
- 移動した場合は「🔄 位置更新」で現在地基準に再配置
- コンソールログで配置座標を確認可能

## カスタマイズ

### 3Dモデルの追加

1. GLBまたはGLTF形式の3Dモデルを用意
2. `assets/models/` ディレクトリに配置
3. HTMLファイルで以下のように参照:

```html
<a-entity
    gltf-model="url(assets/models/your-model.glb)"
    scale="0.5 0.5 0.5"
    position="0 0 0"
></a-entity>
```

### 位置情報の変更

`location-ar.html` で座標を変更:

```html
<a-entity
    gps-projected-entity-place="latitude: YOUR_LAT; longitude: YOUR_LON"
    scale="15 15 15"
>
    <!-- 3Dコンテンツ -->
</a-entity>
```

## 動作要件

- モダンブラウザ（Chrome、Safari、Firefox）
- カメラ付きデバイス
- HTTPSまたはlocalhost環境
- 位置情報AR: GPS対応デバイス、ジャイロスコープ推奨

## 技術スタック

- [AR.js](https://ar-js-org.github.io/AR.js-Docs/) - ARライブラリ
- [A-Frame](https://aframe.io/) - WebVRフレームワーク
- HTML5/CSS3/JavaScript

## トラブルシューティング

詳細は [doc/TROUBLESHOOTING.md](doc/TROUBLESHOOTING.md) を参照。

### GLB読み込みでページが固まる（重要）

**症状**: AR.js + A-FrameでGLBを読み込むとページが固まる、応答なし

**根本原因**:
- Draco/Meshopt/KTX2圧縮されたGLBに対するデコーダ不足
- MIME/CORS設定の不備
- ブラウザキャッシュの問題

**対策（すでに実装済み）**:

1. **server.py - MIME/CORS/キャッシュ対応**
   ```python
   # GLB/WASM/KTX2の正しいMIME設定
   mimetypes.add_type('model/gltf-binary', '.glb')
   mimetypes.add_type('application/wasm', '.wasm')
   mimetypes.add_type('image/ktx2', '.ktx2')
   
   # CORSヘッダー（Cloudflare Tunnel対応）
   Access-Control-Allow-Origin: *
   
   # キャッシュ抑止（固まり回避）
   Cache-Control: no-store, no-cache, must-revalidate
   ```

2. **デコーダ導入（全HTMLページ）**
   - DRACOLoader: Draco圧縮GLB対応
   - KTX2Loader: KTX2テクスチャ対応
   - MeshoptDecoder: Meshopt圧縮対応

3. **テストページで切り分け**
   - `test-viewer.html`: AR無しでGLB読み込みテスト
   - コンソールで詳細ログを確認
   - 15秒ウォッチドッグで長時間読み込みを検出

**テスト手順**:

```bash
# 1. サーバー起動
python3 server.py

# 2. テストページにアクセス
http://localhost:8000/test-viewer.html

# 3. コンソール（F12）で確認
[init] GLBデコーダ初期化開始
[decoder] ✅ DRACOLoader 設定
[decoder] ✅ KTX2Loader 設定
[decoder] ✅ GLTFLoader に DRACOLoader 適用
📦 読み込み進捗: 45.2% (234.5 KB / 521.2 KB)
✅ モデル読み込み完了！
```

**まだ固まる場合**:

1. **GLBファイルを検証**
   ```bash
   # gltf.reportで検証
   https://gltf.report/
   ```

2. **ネットワークタブで確認**
   - GLBファイルが200 OKで返ってくるか
   - Type が `model/gltf-binary` か
   - サイズが大きすぎないか（推奨: 10-20MB以下）

3. **キャッシュクリア**
   - ブラウザのハードリロード: Ctrl+Shift+R / Cmd+Shift+R
   - サーバー再起動後に再度アクセス

### 3Dモデルビューアーでモデルが読み込めない

**症状**: ローディングが終わらない、エラーメッセージが表示される

**原因と対処法**:

1. **サーバーが起動していない**
   ```bash
   # サーバーを起動
   cd /Users/harutosasaki/GithubRepo/ARjs
   python3 server.py
   ```
   
2. **Cloudflare Tunnelの問題**
   - Cloudflare Tunnelを使用している場合、ローカルサーバー（localhost:8000）への接続が必要です
   - Tunnel経由だとファイルアクセスが拒否される場合があります
   - **推奨**: ローカルネットワークで直接アクセス（`http://localhost:8000`）

3. **ファイルパスの確認**
   - コンソール（F12）でエラーメッセージを確認
   - エラー表示に正しいファイルパスが表示されているか確認

4. **ブラウザのキャッシュ**
   - ブラウザのキャッシュをクリアして再読み込み（Ctrl+Shift+R / Cmd+Shift+R）

**確認方法**:
- ブラウザのコンソール（F12）を開く
- Network タブでファイルの読み込み状況を確認
- 赤い行がある場合、そのファイルが読み込めていません

**プログレスバーの見方**:
- モデル名、パーセンテージ、ファイルサイズが表示されます
- 例: `📦 🦆 Duck` → `45% (234.5 KB / 521.2 KB)`

### カメラが起動しない
- HTTPSまたはlocalhostで実行しているか確認
- ブラウザのカメラ許可設定を確認
- 別のブラウザで試す

### マーカーが認識されない
- マーカーが鮮明に印刷/表示されているか確認
- 照明が十分か確認
- マーカー全体がカメラに収まっているか確認

### 位置情報ARでコンテンツが表示されない

**受け入れ基準（テスト手順）**:

1. **iOS姿勢許可**: iPhone/Safariで「開始」ボタン押下後、コンソールに以下が表示される
   ```
   [perm] DeviceMotion: granted
   [perm] DeviceOrientation: granted
   ```

2. **AR.jsイベント確認**: コンソールに以下のログが出る（**これが出なければ配線ミス**）
   ```
   [arjs origin] GPS原点が設定されました: {...}
   [arjs gps] GPS位置更新: {latitude: ..., longitude: ...}
   ```

3. **近距離テスト箱（poi-near）**: 起動数秒で、+5m東に青い箱が視界内に出る
   ```
   [spawn] near-box ~+5m東 at {lat: ..., lon: ...}
   ```

4. **固定座標箱（poi-fixed）**: 少し移動すると、固定座標の橙色の箱が出る
   ```
   [spawn] fixed-box at target {lat: 39.80235, lon: 141.13605}
   ```

5. **メッシュ可視性**: 1.5秒ごとに `[mesh check]` が表示され、`visible: true` になる
   ```
   [mesh check] {poi-near: {exists: true, visible: true}, poi-fixed: {exists: true, visible: true}}
   ```

6. **GLB差し替え（手動）**: コンソールで以下を実行してGLBに切り替え
   ```javascript
   swapToGLB('poi-fixed')  // 固定座標をDuck.glbに
   swapToGLB('poi-near')   // 近距離をDuck.glbに
   ```

7. **Network確認**: ブラウザのNetworkタブで `Duck.glb` が 200 OK

**よくある落とし穴**:
- AR.jsイベントが出ない → `gps-camera` がDOMにない / 姿勢許可未取得
- 遠距離すぎて見えない → 近距離+5mでまず湧かせる
- 視錐台が足りない → `camera="far: 20000"` 確認
- 地面に埋没 → `position="0 3 0"` で地上3m
- GLBだけ見えない → `crossorigin="anonymous"` + Network 200

**デバッグログ**:
- コンソールを開いて（F12 または Cmd+Option+I）リアルタイムログを確認
- サーバーログ（`ar_model_logs.txt`）で詳細な動作履歴を確認

### スマホでの動作確認
[doc/setup-ioscheck.md](doc/setup-ioscheck.md) を参照。

## 参考URL

- [AR.js公式ドキュメント](https://ar-js-org.github.io/AR.js-Docs/)
- [A-Frame公式サイト](https://aframe.io/)
- [Qiita記事1](https://qiita.com/dsudo/items/58718e9e3c870e6b92e6)
- [Qiita記事2](https://qiita.com/Mk459/items/c8fa67a6044178a802ec)

## ライセンス

このプロジェクトはデモ/学習目的で作成されています。

## 今後の改善案

- [ ] カスタム3Dモデルの追加
- [ ] より多くの岩手県の名所の追加
- [ ] ユーザーインタラクション（タップでアニメーション等）
- [ ] 音声ガイドの追加
- [ ] AR体験のスクリーンショット機能